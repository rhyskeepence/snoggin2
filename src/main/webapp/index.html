<lift:surround with="default" at="content">

<div id="ajax-loader" style="display:none;">
    <div style="position: absolute; top: 50%; left: 50%; width: 100%">
        <img src="/images/ajax-loader.gif" style="vertical-align: middle;"/> Loading...
    </div>
    <div style="position: absolute; top: 0; left: 0; height: 100%; width: 100%; line-height: 20px; text-align: center; background-color: #aaa; opacity: 0.1;"></div>
</div>

<h1>Noggin graphs</h1>

<h3>Queues</h3>
<ul>
    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqllustreamToColliderEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqllustreamToColliderDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=LlustreamplusToCollider%20Queue%20-%20daily%20enqueue/dequeue%20count">
        LlustreamplusToCollider Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqcolliderToLlustreamEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqcolliderToLlustreamDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=ColliderToLlustreamplus%20Queue%20-%20daily%20enqueue/dequeue%20count">
        ColliderToLlustreamplus Queue - daily enqueue/dequeue count</a>
    </li>
</ul>

<h3>Queue Graph Builder</h3>
<lift:queue_graph_builder>
    <form>
        Queue:
        <select id="brokers"></select>
        <select id="queues"></select>
        <select id="function"></select>
        <a href="#" id="render_button" class="btn">Render</a>
    </form>
</lift:queue_graph_builder>

<h3>Netstream availability</h3>
<ul>
    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount&days=7&title=Active%20MQ%20-%20thread%20usage%20over%20the%20past%207%20days">
        Active MQ - thread usage over the past 7 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount&days=28&aggregate=average&title=Active%20MQ%20-%20average%20thread%20usage%20per%20day%20over%20the%20past%2028%20days">
        Active MQ - average thread usage per day over the past 28 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:jvmTotalMemory,activemq-berylcoral:jvmUsedMemory,activemq-berylcoral:jvmFreeMemory&days=7&title=Active%20MQ%20-%20memory%20usage%20over%20the%20past%207%20days">
        Active MQ - memory usage over the past 7 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount,aview-prod:jvmThreadCount,bandaid-diamondquartz:jvmThreadCount,bungie-lapiz:jvmThreadCount,bungie-topaz:jvmThreadCount,dnr-diamondquartz:jvmThreadCount,grandma-lapiz:jvmThreadCount,grandma-topaz:jvmThreadCount,halo-diamondquartz:jvmThreadCount,hector-diamondquartz:jvmThreadCount,knitware-diamondquartz:jvmThreadCount,lama-lapiz:jvmThreadCount,lama-topaz:jvmThreadCount,llustreamplus-diamondquartz:jvmThreadCount,ned-diamondquartz:jvmThreadCount,nemo-lapiz:jvmThreadCount,nemo-topaz:jvmThreadCount,pacman-amberamethyst:jvmThreadCount,pacman-diamondquartz:jvmThreadCount,penfold-diamondquartz:jvmThreadCount,puma-lapiz:jvmThreadCount,puma-topaz:jvmThreadCount,reportviewer-lapiz:jvmThreadCount,reportviewer-topaz:jvmThreadCount,scheduler-diamondquartz:jvmThreadCount,sideshow-diamondquartz:jvmThreadCount,spm-diamondquartz:jvmThreadCount,swish-lapiz:jvmThreadCount,swish-topaz:jvmThreadCount,troll-citrinesapphire:jvmThreadCount,twig-diamondquartz:jvmThreadCount,uma-lapiz:jvmThreadCount,uma-topaz:jvmThreadCount&days=7&aggregate=errors&title=Downtime%20(in%20minutes)%20over%20the%20past%2014%20days">
        Downtime (in minutes) over the past 7 days</a>
    </li>

    <li><a href="chart.html?fields=aview-prod:databaseborrowedConnectionsCount,bandaid-diamondquartz:databaseNumBusyConnections,dnr-diamondquartz:databaseNumBusyConnections,hector-diamondquartz:databaseNumBusyConnections,knitware-diamondquartz:databaseNumBusyConnections,llustreamplus-diamondquartz:databaseNumBusyConnections,ned-diamondquartz:databaseNumBusyConnections,pacman-amberamethyst:databaseNumBusyConnections,pacman-diamondquartz:databaseNumBusyConnections,penfold-diamondquartz:databaseNumBusyConnections,sideshow-diamondquartz:databaseNumBusyConnections,spm-diamondquartz:databaseNumBusyConnections,twig-diamondquartz:databaseNumBusyConnections,orca-diamondquartz:database-collider_userNumBusyConnections,orca-diamondquartz:database-rolo_userNumBusyConnections,fttc-diamondquartz:databaseNumBusyConnections,halo-diamondquartz:databaseNumBusyConnections&days=7&title=Database%20connections%20in%20use">
        Netstream Database connections in use</a>
    </li>

    <li><a href="chart.html?fields=orca-diamondquartz:database-collider_userNumBusyConnections,orca-diamondquartz:database-rolo_userNumBusyConnections,fttc-diamondquartz:databaseNumBusyConnections,halo-diamondquartz:databaseNumBusyConnections&days=7&title=Halo%20LHC%20Database%20Connections%20In%20Use">
        Halo LHC Database Connections in use</a>
    </li>

    <li><a href="chart.html?fields=bungie-lapiz:databaseNumBusyConnections,bungie-topaz:databaseNumBusyConnections,grandma-lapiz:databaseNumBusyConnections,grandma-topaz:databaseNumBusyConnections,lama-lapiz:databaseNumBusyConnections,lama-topaz:databaseNumBusyConnections,nemo-lapiz:databaseNumBusyConnections,nemo-topaz:databaseNumBusyConnections,puma-lapiz:databaseNumBusyConnections,puma-topaz:databaseNumBusyConnections,reportviewer-lapiz:databaseNumBusyConnections,reportviewer-topaz:databaseNumBusyConnections,swish-lapiz:databaseNumBusyConnections,swish-topaz:databaseNumBusyConnections,uma-lapiz:databaseNumBusyConnections,uma-topaz:databaseNumBusyConnections&days=7&title=Database%20connections%20in%20use">
        NIM Database connections in use</a>
    </li>
</ul>

<h3>Pacman</h3>
<ul>
    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalRequests,pacman-amberamethyst:pacmanLineCheckerTotalFailures,pacman-amberamethyst:pacmanLineCheckerTotalExceptions,pacman-amberamethyst:pacmanDNCheckerTotalRequests,pacman-amberamethyst:pacmanDNCheckerTotalFailures,pacman-amberamethyst:pacmanDNCheckerTotalExceptions,pacman-amberamethyst:pacmanLluExchangeTotalRequests,pacman-amberamethyst:pacmanLluExchangeTotalFailures,pacman-amberamethyst:pacmanLluExchangeTotalExceptions,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalRequests,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalFailures,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalExceptions,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalRequests,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalFailures,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalExceptions,pacman-amberamethyst:xmlResponderTotalRequests,pacman-amberamethyst:xmlResponderTotalFailures,pacman-amberamethyst:xmlResponderTotalExceptions&days=7&title=Pacman%20(amberamethyst)%20-%20Requests,%20Failures%20and%20Exceptions">
        Pacman (amberamethyst) - Requests, Failures and Exceptions</a>
    </li>

    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalFailures,pacman-amberamethyst:pacmanDNCheckerTotalFailures,pacman-amberamethyst:pacmanLluExchangeTotalFailures,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalFailures,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalFailures,pacman-amberamethyst:xmlResponderTotalFailures&days=7&title=Pacman%20(amberamethyst)%20-%20Failures">
        Pacman (amberamethyst) - Failures</a>
    </li>

    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalExceptions,pacman-amberamethyst:pacmanDNCheckerTotalExceptions,pacman-amberamethyst:pacmanLluExchangeTotalExceptions,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalExceptions,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalExceptions,pacman-amberamethyst:xmlResponderTotalExceptions&days=7&title=Pacman%20(amberamethyst)%20-%20Exceptions">
        Pacman (amberamethyst) - Exceptions</a>
    </li>
</ul>

<hr/>
<h1>Or, choose your own adventure</h1>
    <br/>
    <span id="title_help">Title (optional)</span>: <input type="text" id="graphTitle" onkeyup="graphTitle = this.value; render();" />  <br/><br/>
    <span id="duration_help">Graph duration</span>: previous <input type="text" id="days" style="width: 40px" onkeyup="days = this.value; render();" /> days, or
    from <input type="text" id="from_date" style="width: 120px" />
    to   <input type="text" id="to_date" style="width: 120px" />
    <br/><br/>

    <span id="aggregator_help">Aggregator</span>:
    <select id="aggregator_select" onchange="aggregator = this.value; render();">
        <option value="None">No aggregation, show detail</option>
        <option value="sum">Sum of all values, per day</option>
        <option value="average">Average of all values, per day</option>
        <option value="errors">Amount of downtime, in minutes, per day</option>
        <option value="dailythroughput">Daily Throughput (only used for ActiveMQ's ThroughputPerSecond)</option>
    </select>

    <br/>
    <br/>

    <span id="semigroup_help">Semigroup</span>:
    <select id="semigroup_select" onchange="semigroup = this.value; render();">
        <option value="none">Don't combine metrics</option>
        <option value="add">Addition</option>
        <option value="subtract">Subtraction</option>
        <option value="multiply">Multiplication</option>
        <option value="divide">Division</option>
    </select>

    <br/>
    <br/>

    <lift:Metrics>
        <form>
            <span id="metric_help">Application / metric</span>:
            <select id="applications"></select>
            <select id="metric_select"></select>
            <a href="#" id="add_button" class="btn">Add</a>
        </form>
    </lift:Metrics>

    <div style="margin-top: 50px;">
        <pre id="generated_url"></pre>
        <a id="clickable" class="btn" href="#" onclick="$('#load-clicked').show()">Click to view</a>

        <span style="display:none" id="load-clicked">
            <img src="/images/ajax-loader.gif" style="vertical-align: middle;" width="20" height="20"/>
        </span>

    </div>

    <script>
        var aggregator = "None";
        var days = 7;
        var metrics = [];
        var graphTitle = "";
        var fromDate = "";
        var toDate = "";
        var semigroup = "";

        function append_metric(name) {
            metrics.push(name);
            render();
        }

        function render() {
            var url = "chart.html?fields=" + metrics.join(",");

            if (fromDate != "" && toDate != "") {
                url += "&fromDate=" + fromDate;
                url += "&toDate=" + toDate;

            } else {
                url += "&days=" + days
            }

            if (aggregator != "None") {
                url += "&aggregate=" + aggregator;
            }
            if (graphTitle != "") {
                url += "&title=" + encodeURI(graphTitle);
            }
            if (semigroup != "") {
                url += "&semigroup=" + encodeURI(semigroup);
            }

            $("#generated_url").html(url);
            $("#clickable").attr("href", url);
        }

        $(document).ready(function() {
            $("#graphTitle").val(graphTitle);
            $("#days").val(days);
            $("#applications").prop("selectedIndex",0);
            $("#metric_select").prop("selectedIndex",0);
            $("#aggregator_select").prop("selectedIndex",0);
            $("#semigroup_select").prop("selectedIndex",0);

            var onCloseFromDate = function(dateText, inst) {
                var toDateSelector = $("#to_date");
                if (dateText != "") {
                   if (toDate == "") {
                        toDateSelector.datepicker("setDate" , new Date() );
                        toDate = toDateSelector.val();
                   }
                   toDateSelector.datepicker( "option", "minDate", $("#from_date").datepicker("getDate") );
                }
                fromDate = dateText;
                render();
            }
            $("#from_date").datepicker({ minDate: "-1y", maxDate: new Date(), dateFormat: "dd-mm-yy", onClose: onCloseFromDate });
            $("#to_date").datepicker({ minDate: "-1y", maxDate: new Date(), dateFormat: "dd-mm-yy", onClose: function(dateText, inst) { toDate = dateText; render(); } });

            $("#title_help").qtip({
                content: 'Optional title displayed above the graph'
            });

            $("#duration_help").qtip({
                content: 'Specify either a number of days (0 for today only, 1 for yesterday, etc), or choose an inclusive date range by clicking from and to'
            });

            $("#aggregator_help").qtip({
                content: 'Aggregate each metric using an aggregator.<br/><br/>The <em>sum per day</em> aggregator will show the total of all values each day, for each metric.<br/>The <em>average per day</em> aggregator will show the average of all values each day, for each metric.<br/>The <em>downtime per day</em> aggregator will show the total number of seconds each day when the application could not be reached.<br/>The <em>daily throughput</em> aggregator is used for -ThroughputPerSecond metrics, and will show the daily queue throughput.<br/>'
            });

            $("#semigroup_help").qtip({
                content: 'A semigroup is an operation that can be used to combine all of the chosen metrics into a single line segment. For example, to see the total number of pending items in all queues, add all QueueSize metrics to the graph and choose the <em>Addition<em> semigroup'
            });

            $("#metric_help").qtip({
                content: 'Choose an application followed by metric, then click add.'
            });


            render();

        });
    </script>
</lift:surround>