<lift:surround with="default" at="content">

<h1>Noggin charts</h1>

<h3>Queues</h3>
<ul>
    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount&days=7&title=Active%20MQ%20-%20thread%20usage%20over%20the%20past%207%20days">
        Active MQ - thread usage over the past 7 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount&days=28&aggregate=average&title=Active%20MQ%20-%20average%20thread%20usage%20per%20day%20over%20the%20past%2028%20days">
        Active MQ - average thread usage per day over the past 28 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:jvmTotalMemory,activemq-berylcoral:jvmUsedMemory,activemq-berylcoral:jvmFreeMemory&days=7&title=Active%20MQ%20-%20memory%20usage%20over%20the%20past%207%20days">
        Active MQ - memory usage over the past 7 days</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqhaloInternalEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqhaloInternalDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=&title=HaloInternal%20Queue%20-%20daily%20enqueue/dequeue%20count">
        HaloInternal Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqhaloToKnitwareEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqhaloToKnitwareDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=HaloToKnitware%20Queue%20-%20daily%20enqueue/dequeue%20count">
        HaloToKnitware Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqhaloToLlustreamplusEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqhaloToLlustreamplusDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=HaloToLlustreamplus%20Queue%20-%20daily%20enqueue/dequeue%20count">
        HaloToLlustreamplus Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqhaloToSideshowEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqhaloToSideshowDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=HaloToSideshow%20Queue%20-%20daily%20enqueue/dequeue%20count">
        HaloToSideshow Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqhectorToHaloEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqhectorToHaloDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=HectorToHalo%20Queue%20-%20daily%20enqueue/dequeue%20count">
        HectorToHalo Queue - daily enqueue/dequeue count</a>
    </li>

     <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqllustreamplusToHaloEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqllustreamplusToHaloDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=LlustreamplusToHalo%20Queue%20-%20daily%20enqueue/dequeue%20count">
        LlustreamplusToHalo Queue - daily enqueue/dequeue count</a>
    </li>

    <li><a href="chart.html?fields=activemq-berylcoral:ActiveMqnedToHaloEnqueueCountThroughputPerSecond,activemq-berylcoral:ActiveMqnedToHaloDequeueCountThroughputPerSecond&days=7&aggregate=dailythroughput&title=NedToHalo%20Queue%20-%20daily%20enqueue/dequeue%20count">
        NedToHalo Queue - daily enqueue/dequeue count</a>
    </li>
</ul>

<h3>Netstream availability</h3>
<ul>
    <li><a href="chart.html?fields=activemq-berylcoral:jvmThreadCount,aview-prod:jvmThreadCount,bandaid-diamondquartz:jvmThreadCount,bungie-lapiz:jvmThreadCount,bungie-topaz:jvmThreadCount,dnr-diamondquartz:jvmThreadCount,grandma-lapiz:jvmThreadCount,grandma-topaz:jvmThreadCount,halo-diamondquartz:jvmThreadCount,hector-diamondquartz:jvmThreadCount,knitware-diamondquartz:jvmThreadCount,lama-lapiz:jvmThreadCount,lama-topaz:jvmThreadCount,llustreamplus-diamondquartz:jvmThreadCount,ned-diamondquartz:jvmThreadCount,nemo-lapiz:jvmThreadCount,nemo-topaz:jvmThreadCount,pacman-amberamethyst:jvmThreadCount,pacman-diamondquartz:jvmThreadCount,penfold-diamondquartz:jvmThreadCount,puma-lapiz:jvmThreadCount,puma-topaz:jvmThreadCount,reportviewer-lapiz:jvmThreadCount,reportviewer-topaz:jvmThreadCount,scheduler-diamondquartz:jvmThreadCount,sideshow-diamondquartz:jvmThreadCount,spm-diamondquartz:jvmThreadCount,swish-lapiz:jvmThreadCount,swish-topaz:jvmThreadCount,troll-citrinesapphire:jvmThreadCount,twig-diamondquartz:jvmThreadCount,uma-lapiz:jvmThreadCount,uma-topaz:jvmThreadCount&days=14&aggregate=errors&title=Downtime%20(in%20minutes)%20over%20the%20past%2014%20days">
        Downtime (in minutes) over the past 14 days</a>
    </li>
    <li><a href="http://budgie.sns.sky.com:8000/chart.html?fields=aview-prod:databaseborrowedConnectionsCount,bandaid-diamondquartz:databaseNumBusyConnections,bungie-lapiz:databaseNumBusyConnections,bungie-topaz:databaseNumBusyConnections,dnr-diamondquartz:databaseNumBusyConnections,grandma-lapiz:databaseNumBusyConnections,grandma-topaz:databaseNumBusyConnections,halo-diamondquartz:databaseNumBusyConnections,hector-diamondquartz:databaseNumBusyConnections,knitware-diamondquartz:databaseNumBusyConnections,lama-lapiz:databaseNumBusyConnections,lama-topaz:databaseNumBusyConnections,llustreamplus-diamondquartz:databaseNumBusyConnections,ned-diamondquartz:databaseNumBusyConnections,nemo-lapiz:databaseNumBusyConnections,nemo-topaz:databaseNumBusyConnections,pacman-amberamethyst:databaseNumBusyConnections,pacman-diamondquartz:databaseNumBusyConnections,penfold-diamondquartz:databaseNumBusyConnections,puma-lapiz:databaseNumBusyConnections,puma-topaz:databaseNumBusyConnections,reportviewer-lapiz:databaseNumBusyConnections,reportviewer-topaz:databaseNumBusyConnections,sideshow-diamondquartz:databaseNumBusyConnections,spm-diamondquartz:databaseNumBusyConnections,swish-lapiz:databaseNumBusyConnections,swish-topaz:databaseNumBusyConnections,twig-diamondquartz:databaseNumBusyConnections,uma-lapiz:databaseNumBusyConnections,uma-topaz:databaseNumBusyConnections&days=7&title=Database%20connections%20in%20use">
        Database connections in use</a>
    </li>
</ul>

<h3>Pacman</h3>
<ul>
    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalRequests,pacman-amberamethyst:pacmanLineCheckerTotalFailures,pacman-amberamethyst:pacmanLineCheckerTotalExceptions,pacman-amberamethyst:pacmanDNCheckerTotalRequests,pacman-amberamethyst:pacmanDNCheckerTotalFailures,pacman-amberamethyst:pacmanDNCheckerTotalExceptions,pacman-amberamethyst:pacmanLluExchangeTotalRequests,pacman-amberamethyst:pacmanLluExchangeTotalFailures,pacman-amberamethyst:pacmanLluExchangeTotalExceptions,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalRequests,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalFailures,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalExceptions,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalRequests,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalFailures,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalExceptions,pacman-amberamethyst:xmlResponderTotalRequests,pacman-amberamethyst:xmlResponderTotalFailures,pacman-amberamethyst:xmlResponderTotalExceptions&days=7&title=Pacman%20(amberamethyst)%20-%20Requests,%20Failures%20and%20Exceptions">
        Pacman (amberamethyst) - Requests, Failures and Exceptions</a>
    </li>

    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalFailures,pacman-amberamethyst:pacmanDNCheckerTotalFailures,pacman-amberamethyst:pacmanLluExchangeTotalFailures,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalFailures,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalFailures,pacman-amberamethyst:xmlResponderTotalFailures&days=7&title=Pacman%20(amberamethyst)%20-%20Failures">
        Pacman (amberamethyst) - Failures</a>
    </li>

    <li><a href="chart.html?fields=pacman-amberamethyst:pacmanLineCheckerTotalExceptions,pacman-amberamethyst:pacmanDNCheckerTotalExceptions,pacman-amberamethyst:pacmanLluExchangeTotalExceptions,pacman-amberamethyst:pacmanPhoneLineInformationServiceTotalExceptions,pacman-amberamethyst:pacmanProductAvailabilityCheckerTotalExceptions,pacman-amberamethyst:xmlResponderTotalExceptions&days=7&title=Pacman%20(amberamethyst)%20-%20Exceptions">
        Pacman (amberamethyst) - Exceptions</a>
    </li>
</ul>

<hr/>
<h1>Or, choose your own adventure</h1>
    <br/>
    Title (optional): <input type="text" id="graphTitle" onkeyup="graphTitle = this.value; render();" />  <br/><br/>
    Graph duration: previous <input type="text" id="days" style="width: 40px" onkeyup="days = this.value; render();" /> days, or
    from <input type="text" id="from_date" style="width: 120px" />
    to   <input type="text" id="to_date" style="width: 120px" />
    <br/><br/>

    Aggregator:
    <select id="aggregator_select" onchange="aggregator = this.value; render();">
        <option value="None">No aggregation, show detail</option>
        <option value="sum">Sum of all values, per day</option>
        <option value="average">Average of all values, per day</option>
        <option value="errors">Amount of downtime, in minutes, per day</option>
        <option value="dailythroughput">Daily Throughput (only used for ActiveMQ's ThroughputPerSecond)</option>
    </select>

    <br/>
    <br/>

    <lift:Metrics>
        <form>
            Application / metric:
            <select id="applications"></select>

            <span style="display:none" id="ajax-loader">
                <img src="/images/ajax-loader.gif" style="vertical-align: middle;" width="20" height="20"/>
            </span>

            <select id="metric_select"></select>
            <a href="#" id="add_button" class="btn">Add</a>
        </form>
    </lift:Metrics>

    <div style="margin-top: 50px;">
        <pre id="generated_url"></pre>
        <a id="clickable" class="btn" href="#" onclick="$('#load-clicked').show()">Click to view</a>

        <span style="display:none" id="load-clicked">
            <img src="/images/ajax-loader.gif" style="vertical-align: middle;" width="20" height="20"/>
        </span>

    </div>

    <script>
        var aggregator = "None";
        var days = 7;
        var metrics = new Array();
        var graphTitle = "";
        var fromDate = "";
        var toDate = "";

        function append_metric(name) {
            metrics.push(name);
            render();
        }

        function render() {
            var url = "chart.html?fields=" + metrics.join(",");

            if (fromDate != "" && toDate != "") {
                url += "&fromDate=" + fromDate;
                url += "&toDate=" + toDate;

            } else {
                url += "&days=" + days
            }

            if (aggregator != "None") {
                url += "&aggregate=" + aggregator;
            }
            if (graphTitle != "") {
                url += "&title=" + encodeURI(graphTitle);
            }

            $("#generated_url").html(url);
            $("#clickable").attr("href", url);
        }

        $(document).ready(function() {
            $("#graphTitle").val(graphTitle);
            $("#days").val(days);
            $("#applications").prop("selectedIndex",0);
            $("#metric_select").prop("selectedIndex",0);
            $("#aggregator_select").prop("selectedIndex",0);

            var onCloseFromDate = function(dateText, inst) {
                var toDateSelector = $("#to_date");
                if (dateText != "") {
                   if (toDate == "") {
                        toDateSelector.datepicker("setDate" , new Date() );
                        toDate = toDateSelector.val();
                   }
                   toDateSelector.datepicker( "option", "minDate", $("#from_date").datepicker("getDate") );
                }
                fromDate = dateText;
                render();
            }
            $("#from_date").datepicker({ minDate: "-1y", maxDate: new Date(), dateFormat: "dd-mm-yy", onClose: onCloseFromDate });
            $("#to_date").datepicker({ minDate: "-1y", maxDate: new Date(), dateFormat: "dd-mm-yy", onClose: function(dateText, inst) { toDate = dateText; render(); } });

            render();

        });

    </script>

    <hr/>
    <h1>UDP Listener</h1>
    <p>Ad-hoc metrics can be inserted by sending a UDP message to port 8011. The payload must be in the format:</p><pre>[application]:[metric-name]=[numeric-value]</pre>

</lift:surround>
